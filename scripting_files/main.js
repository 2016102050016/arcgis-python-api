define(["dojo/_base/declare","dojo/_base/lang","dojo/cookie","dojo/topic","dojo/query","dojo/dom-construct","Notifications","esri/config","esri/request","esri/urlUtils"],function(a,b,c,d,e,f,g,h,i,j){var k=/^(https?:\/\/(arcgis.com|esri.com|.+.arcgis.com|.+.esri.com)|\/)/;esri&&esri.id&&(esri.id._doPortalSignIn=function(){return!1}),h.defaults.io.proxyUrl="/proxy",h.defaults.io.corsEnabledServers.push(SiteConfig.billing),h.defaults.io.corsEnabledServers.push(SiteConfig.download_server),h.defaults.io.corsEnabledServers.push("https://geotriggerstg.arcgis.com"),h.defaults.io.corsEnabledServers.push("https://geotriggerdev.arcgis.com"),h.defaults.io.corsEnabledServers.push("https://geotrigger.arcgis.com"),h.defaults.io.corsEnabledServers.push("https://portalette.geotrigger.arcgis.com"),h.defaults.io.corsEnabledServers.push("https://portalettestg.geotrigger.arcgis.com");var l=a([],{constructor:function(a){b.mixin(this,a)},_callbacks:[],ready:!1,get_gravatar:function(a,b){var c=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/rn/g,"n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=Array(),y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()},b=b||80;return"//www.gravatar.com/avatar/"+c(a)+".jpg?s="+b},redirect:function(a,b){k.test(a)||(a="http://developers.arcgis.com"),b&&(b=dojo.objectToQuery(b)),window.location=a+(b?"?"+b:"")},queue:function(a){this.ready?a():this._callbacks.push(a)},avatar:function(a){return this.profile.thumbnail?"https://"+SiteConfig.ago+"/sharing/rest/community/users/"+this.username()+"/info/"+this.profile.thumbnail+"?token="+this.token():this.get_gravatar(this.profile.email,a||18)+"&d=mm"},loggedIn:function(){return!!this.token()},displayName:function(){return this.profile?profile.fullName||this.username()||profile.email||"Your Account":this.username()},orgId:function(){return this.organization?this.organization.id:c("esri_auth")?JSON.parse(c("esri_auth")).accountId:void 0},orgUrlKey:function(){return this.organization?this.organization.urlKey:c("esri_auth")?JSON.parse(c("esri_auth")).urlKey:void 0},orgUrl:function(){if(this.organization){var a=this.organization.allSSL?"https://":"http://";return a+this.orgUrlKey()+SiteConfig.ago_maps}return void 0},token:function(){return c("esri_auth")?JSON.parse(c("esri_auth")).token:!1},role:function(){var a=JSON.parse(c("esri_auth"));return a&&a.role?a.role.replace("org_","").replace("account_",""):!1},isAdmin:function(){return"admin"===this.role()},username:function(){return this.profile?this.profile.username:c("esri_auth")?JSON.parse(c("esri_auth")).email:void 0},userId:function(){return this.username()},requireSession:function(){this.loggedIn()||this.redirect("/sign-in",{redirect_uri:window.encodeURIComponent(window.location.href)})},logout:function(){redirect("https://www.arcgis.com/sharing/rest/oauth2/signout",{redirect_uri:SiteConfig.destination})},developerSubscription:function(){return this.organization&&this.organization.subscriptionInfo&&("Trial Developer"===this.organization.subscriptionInfo.type||"Developer"===this.organization.subscriptionInfo.type)?!0:void 0},developer:function(){return this.developerSubscription()},trial:function(){return this.organization&&this.organization.subscriptionInfo.type.match(/Trial/)?!0:void 0},expired:function(){return this.organization&&this.organization.subscriptionInfo&&"expired"===this.organization.subscriptionInfo.state?!0:void 0},suspended:function(){return this.organization&&this.organization.subscriptionInfo&&"suspended"===this.organization.subscriptionInfo.state?!0:void 0},firstName:function(){return this.profile.fullName.split(/ |\.|_/)[0]},finishSignin:function(a){var b=this.isPublicAccount()?"/public-account/":"/applications/",c=j.urlToObject(window.location.href).query,d=c&&c.redirect_uri?c.redirect_uri:b;this.redirect(d)},isPublicAccount:function(){return c("esri_auth")?JSON.parse(c("esri_auth")).role?!1:!0:!1}});window.ArcGIS=window.ArcGIS||{},window.ArcGIS.Session=new l;var m=c("esri_auth"),n=m?JSON.parse(m):void 0;return n&&!window.ArcGIS.shouldExpireSession&&(i({url:SiteConfig.portal+"/rest/portals/self",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(a){ArcGIS.Session.profile=a.user,ArcGIS.Session.organization=a,d.publish("session:organization"),i({url:SiteConfig.billing+"/subscription",content:{token:ArcGIS.Session.token(),f:"json"}}).then(function(a){ArcGIS.Session.subscription=a.subscription,ArcGIS.Session.ready=!0;for(var b=ArcGIS.Session._callbacks.length-1;b>=0;b--)ArcGIS.Session._callbacks[b]();d.publish("session:ready")},function(a){ArcGIS.Session.logout(),document.location.reload(!0)})},function(a){ArcGIS.Session.logout(),document.location.reload(!0)}),ArcGIS.Session.queue(function(){var a=ArcGIS.Session.expired()||ArcGIS.Session.suspended(),b=e("#account-alerts").length;if(b&&a){var c=new g(e("#account-notifications")[0]),d=ArcGIS.Session.developer()&&ArcGIS.Session.expired(),f=ArcGIS.Session.developer()&&ArcGIS.Session.suspended(),h=!ArcGIS.Session.developer();if(d&&c.error("It looks like your account has expired. You won't be able to create new applications or feature services until you <a href='/account/modify-plan/'>renew your account</a>."),f&&c.error("Looks like you went over your credit limit for this month. You won't be able to create new applications or feature services. You can either <a href='/account/modify-plan/'>upgrade to a larger plan</a> or wait until next month."),h){var i=" <a href='"+ArcGIS.Session.orgUrl()+"/home/organization.html'>Upgrade Subscription</a>";c.error("Your subscription has been suspended or has expired."+i)}}})),window.ArcGIS.Session});